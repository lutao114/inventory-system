{% extends "base.html" %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h4><i class="bi bi-journal-text me-2"></i>操作记录</h4>
    <a href="{{ url_for('backup_db') }}" class="btn btn-outline-secondary btn-sm">
        <i class="bi bi-database-fill-gear"></i> 备份数据库
    </a>
</div>

<form method="get" class="row g-3 mb-3">
    <div class="col-md-3 col-sm-6">
        <select name="action" class="form-select form-select-sm">
            <option value="">全部操作</option>
            <option value="in" {% if action_filter == 'in' %}selected{% endif %}>入库</option>
            <option value="out" {% if action_filter == 'out' %}selected{% endif %}>出库</option>
        </select>
    </div>
    <div class="col-md-5 col-sm-6">
        <input type="text" name="name" class="form-control form-control-sm" placeholder="按设备名称筛选..." value="{{ name_filter }}">
    </div>
    <div class="col-md-4 col-12 d-flex gap-2">
        <button type="submit" class="btn btn-primary btn-sm">筛选</button>
        {% if action_filter or name_filter %}
        <a href="{{ url_for('logs') }}" class="btn btn-outline-secondary btn-sm">清空</a>
        {% endif %}
    </div>
</form>

{% if logs %}
<!-- 桌面端：常规表格 -->
<div class="table-responsive d-none d-md-block">
    <table class="table table-striped table-bordered table-hover align-middle mb-0">
        <thead class="table-light">
            <tr>
                <th style="white-space: nowrap;">ID</th>
                <th style="white-space: nowrap;">操作类型</th>
                <th style="white-space: nowrap;">设备信息</th>
                <th style="white-space: nowrap;">数量</th>
                <th style="white-space: nowrap;">操作日期</th>
                <th style="white-space: nowrap;">快递公司</th>
                <th style="white-space: nowrap;">快递单号</th>
                <th style="white-space: nowrap;">安装位置</th>
                <th style="width: 100%;">备注</th>
            </tr>
        </thead>
        <tbody>
            {% for log in logs %}
            <tr>
                <td>{{ log.id }}</td>
                <td>
                    {% if log.action == 'in' %}
                        <span class="badge bg-success">入库</span>
                    {% else %}
                        <span class="badge bg-danger">出库</span>
                    {% endif %}
                </td>
                <td style="white-space: nowrap;">
                    {{ log.item_brand }} {{ log.item_model }}
                    {% if log.item_name and 
                        log.item_name != log.item_brand and 
                        log.item_name != log.item_model and
                        log.item_brand not in log.item_name and
                        log.item_model not in log.item_name %}
                      （{{ log.item_name }}）
                    {% endif %}
                </td>
                <td>{{ log.quantity }}</td>
                <td style="white-space: nowrap;">{{ log.operation_date or '' }}</td>
                <td>{{ log.delivery_company or '' }}</td>
                <td style="word-break: break-word;">{{ log.tracking_number or '' }}</td>
                <td>{{ log.install_location or '' }}</td>
                <td>{{ log.remark or '' }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- 移动端：卡片列表 -->
<div class="d-md-none">
  {% for log in logs %}
  <div class="card mb-3 shadow-sm">
    <div class="card-body p-3">
      <div class="d-flex justify-content-between align-items-start mb-2">
        <h6 class="mb-1">
          {% if log.action == 'in' %}
            <span class="badge bg-success">入库</span>
          {% else %}
            <span class="badge bg-danger">出库</span>
          {% endif %}
          #{{ log.id }}
        </h6>
        <small class="text-muted">{{ log.operation_date or '' }}</small>
      </div>
      
      <p class="mb-1"><strong>{{ log.item_brand }} {{ log.item_model }}</strong></p>
      {% if log.item_name and 
          log.item_name != log.item_brand and 
          log.item_name != log.item_model and
          log.item_brand not in log.item_name and
          log.item_model not in log.item_name %}
        <p class="text-muted small mb-2">（{{ log.item_name }}）</p>
      {% endif %}
      
      <div class="row g-1 small">
        <div class="col-6"><strong>数量：</strong>{{ log.quantity }}</div>
        {% if log.delivery_company %}
        <div class="col-6"><strong>快递：</strong>{{ log.delivery_company }}</div>
        {% endif %}
        {% if log.tracking_number %}
        <div class="col-12"><strong>单号：</strong><span class="text-break">{{ log.tracking_number }}</span></div>
        {% endif %}
        {% if log.install_location %}
        <div class="col-12"><strong>位置：</strong>{{ log.install_location }}</div>
        {% endif %}
        {% if log.remark %}
        <div class="col-12"><strong>备注：</strong>{{ log.remark }}</div>
        {% endif %}
      </div>
    </div>
  </div>
  {% endfor %}
</div>

{% else %}
<div class="alert alert-info">暂无操作记录</div>
{% endif %}
{% endblock %}